{% extends "teams/agileca/layout/split_base.html" %}
{% load static %}

{% block title %}è©³ç´°æ¤œç´¢{% endblock %}

{% block left %}
  {% include "teams/agileca/partials/sidebar.html" %}
{% endblock %}

{% block right %}
    <h2>ğŸ” è©³ç´°æ¤œç´¢</h2>
    <p>è¤‡æ•°ã®æ¡ä»¶ã‚’çµ„ã¿åˆã‚ã›ã¦æ•™å®¤ã‚’æ¤œç´¢ã§ãã¾ã™ã€‚</p>
    
    <form action="{% url 'agileca:search_complex' %}" method="GET" class="search-form" style="border: 1px solid #ccc; padding: 20px; border-radius: 5px; background-color: #f9f9f9;">
        
        <div style="margin-bottom: 15px;">
            <label style="display: block; font-weight: bold; margin-bottom: 5px;">å»ºç‰©å</label>
            <input type="text" name="building_name" value="{{ building_name|default_if_none:'' }}" placeholder="ä¾‹: A" style="padding: 8px; width: 100%; max-width: 400px; border: 1px solid #ddd; border-radius: 4px;">
        </div>

        <div style="margin-bottom: 15px;">
            <label style="display: block; font-weight: bold; margin-bottom: 5px;">éƒ¨å±‹å</label>
            <input type="text" name="room_name" value="{{ room_name|default_if_none:'' }}" placeholder="ä¾‹: 101" style="padding: 8px; width: 100%; max-width: 400px; border: 1px solid #ddd; border-radius: 4px;">
        </div>

        <div style="margin-bottom: 15px;">
            <label style="display: block; font-weight: bold; margin-bottom: 5px;">æ‹…å½“æ•™æˆ</label>
            <input type="text" name="professor_name" value="{{ professor_name|default_if_none:'' }}" placeholder="ä¾‹: éˆ´æœ¨" style="padding: 8px; width: 100%; max-width: 400px; border: 1px solid #ddd; border-radius: 4px;">
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; font-weight: bold; margin-bottom: 5px;">ç‰¹å¾´ãƒ»å±æ€§ (ANDæ¤œç´¢)</label>
            <div class="tag-list" style="display: flex; flex-wrap: wrap; gap: 10px;">
                {% for attr in all_attributes %}
                    <label style="background-color: #fff; padding: 5px 10px; border: 1px solid #ddd; border-radius: 3px; cursor: pointer;">
                        <input 
                            type="checkbox" 
                            name="attribute_ids" 
                            value="{{ attr.id }}" 
                            {% if attr.id|stringformat:"s" in selected_ids %}checked{% endif %}
                        >
                        {{ attr.name }}
                    </label>
                {% endfor %}
            </div>
        </div>
        
        <div style="display: flex; gap: 10px; align-items: center;">
            <button type="submit" style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                æ¤œç´¢ã™ã‚‹
            </button>
            
            {% if request.GET %}
                <a href="{% url 'agileca:search_complex' %}" style="color: #6c757d; text-decoration: none;">
                    æ¡ä»¶ã‚’ã‚¯ãƒªã‚¢
                </a>
            {% endif %}
        </div>
    </form>

    <hr style="margin-top: 30px; margin-bottom: 20px;">

    {% if rooms %}
        <h3>æ¤œç´¢çµæœ ({{ rooms.count }} ä»¶)</h3>
        <ul style="list-style: none; padding: 0;">
            {% for room in rooms %}
                <li style="border: 1px solid #eee; padding: 15px; margin-bottom: 10px; border-left: 5px solid #007bff; border-radius: 5px;">
                    
                    <h4>{{ room.room_name }} ({{ room.floor }}éš)</h4>
                    
                    <p><strong>å»ºç‰©:</strong> 
                        <span style="display: inline-block; background-color: #e0f7ff; color: #007bff; padding: 3px 8px; margin-right: 10px; border-radius: 12px; font-size: 0.9em;">
                            {{ room.building.name }}
                        </span>
                    </p>
                    
                    <p><strong>æ‹…å½“æ•™æˆ:</strong> 
                        {% if room.professor %}
                            <span style="display: inline-block; background-color: #ffe6e6; color: #ff4d4d; padding: 3px 8px; margin-right: 10px; border-radius: 12px; font-size: 0.9em;">
                                {{ room.professor.name }}
                            </span>
                        {% else %}
                            <span style="color: #6c757d;">æœªå®š</span>
                        {% endif %}
                    </p>
                    
                    <p><strong>ç”¨é€”:</strong> 
                        {% for attr in room.attributes.all %}
                            <span style="display: inline-block; background-color: #e6ffed; color: #28a745; padding: 3px 8px; margin-right: 5px; border-radius: 12px; font-size: 0.9em;">
                                {{ attr.name }}
                            </span>
                        {% empty %}
                            <span style="color: #6c757d;">å±æ€§ãªã—</span>
                        {% endfor %}
                    </p>
                </li>
            {% endfor %}
        </ul>
    
    {% elif request.GET %}
        <p>æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹æ•™å®¤ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
    {% endif %}

{% endblock %}
