{% extends 'teams/h34vvy_u53rzz/base.html' %}
{% load h34vvy_tags %}

{% block content %}
<nav class="mb-4 flex items-center justify-between rounded-md bg-slate-900 px-4 py-2 text-white">
  <div class="text-sm font-semibold">ドア開けてや</div>
  <div class="flex items-center gap-2 text-sm text-slate-100">
    {% if user.is_authenticated %}
    {% user_points user as nav_user_points %}
    <span class="rounded bg-white/10 px-3 py-1">
      {{ user.username }}
      {% if nav_user_points is not None %}
      / {{ nav_user_points }} pt
      {% endif %}
    </span>
    <a href="{% url 'h34vvy_u53rzz:logout' %}"
      class="rounded bg-white px-3 py-1 font-semibold text-slate-900 transition hover:-translate-y-0.5 hover:bg-slate-100 hover:text-slate-900 hover:shadow focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/70">ログアウト</a>
    {% else %}
    <a href="{% url 'h34vvy_u53rzz:signup' %}{% if request.GET.next %}?next={{ request.GET.next }}{% endif %}"
      class="rounded bg-white px-3 py-1 font-semibold text-slate-900 transition hover:-translate-y-0.5 hover:bg-slate-100 hover:text-slate-900 hover:shadow focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/70">新規登録</a>
    <a href="{% url 'h34vvy_u53rzz:login' %}{% if request.GET.next %}?next={{ request.GET.next }}{% endif %}"
      class="rounded bg-white px-3 py-1 font-semibold text-slate-900 transition hover:-translate-y-0.5 hover:bg-slate-100 hover:text-slate-900 hover:shadow focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white/70">ログイン</a>
    {% endif %}
  </div>
</nav>

<header class="space-y-2">
  <p class="text-sm font-semibold uppercase tracking-wide text-blue-600">
    ポイント
  </p>
  <h1 class="text-3xl font-bold text-slate-900">ランキング</h1>
  <p class="text-sm text-slate-600">
    助けに行った回数に応じたポイントの順位です。
  </p>
</header>

  <div class="overflow-hidden rounded-xl bg-white shadow">
    <!-- Tabs implementation using CSS Radio Hack -->
    <input type="radio" name="ranking_tab" id="tab_user" class="peer/user hidden" checked>
    <input type="radio" name="ranking_tab" id="tab_lab" class="peer/lab hidden">

    <!-- Tab Navigation -->
    <div class="flex border-b border-slate-200 bg-slate-50">
      <label for="tab_user"
        class="flex-1 cursor-pointer py-3 text-center text-sm font-semibold text-slate-500 hover:text-slate-700 peer-checked/user:border-b-2 peer-checked/user:border-blue-600 peer-checked/user:text-blue-600">
        個人ランキング
      </label>
      <label for="tab_lab"
        class="flex-1 cursor-pointer py-3 text-center text-sm font-semibold text-slate-500 hover:text-slate-700 peer-checked/lab:border-b-2 peer-checked/lab:border-blue-600 peer-checked/lab:text-blue-600">
        研究室ランキング
      </label>
    </div>

    <!-- User Ranking Table -->
    <div class="hidden peer-checked/user:block">
      <table class="min-w-full divide-y divide-slate-200 text-sm">
        <thead class="bg-slate-50 text-left text-xs font-semibold uppercase tracking-wide text-slate-600">
          <tr>
            <th class="px-4 py-3">順位</th>
            <th class="px-4 py-3">ユーザー</th>
            <th class="px-4 py-3 text-right">ポイント</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          {% for item in user_rankings %}
          {% with account=item.account rank=item.rank %}
          {% if account.user_id == current_user_id %}
          <tr class="bg-blue-50/70 font-semibold text-blue-900">
            {% else %}
          <tr>
            {% endif %}
            <td class="px-4 py-3">{{ rank }}</td>
            <td class="px-4 py-3">
              {{ account.username }}
              {% if account.laboratory %}
              <span class="ml-2 rounded bg-slate-100 px-1.5 py-0.5 text-xs text-slate-500">{{ account.laboratory.name }}</span>
              {% endif %}
            </td>
            <td class="px-4 py-3 text-right font-semibold">{{ account.points }} pt</td>
          </tr>
          {% endwith %}
          {% empty %}
          <tr>
            <td colspan="3" class="px-4 py-6 text-center text-slate-500">
              まだランキング対象のユーザーがいません。
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Laboratory Ranking Table -->
    <div class="hidden peer-checked/lab:block">
      <table class="min-w-full divide-y divide-slate-200 text-sm">
        <thead class="bg-slate-50 text-left text-xs font-semibold uppercase tracking-wide text-slate-600">
          <tr>
            <th class="px-4 py-3">順位</th>
            <th class="px-4 py-3">研究室</th>
            <th class="px-4 py-3 text-right">合計ポイント</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          {% for item in lab_rankings %}
          <tr>
            <td class="px-4 py-3">{{ item.rank }}</td>
            <td class="px-4 py-3">{{ item.lab.name }}</td>
            <td class="px-4 py-3 text-right font-semibold">{{ item.points }} pt</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3" class="px-4 py-6 text-center text-slate-500">
              まだランキング対象の研究室がいません。
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
