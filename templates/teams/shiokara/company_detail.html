{# templates/teams/shiokara/company_detail.html #}
{% extends "teams/shiokara/base.html" %}

{% block content %}
<h1>{{ company.name }}</h1>

<p>ここは {{ company.name }} の体験談・インターン情報などを載せる予定のページです。</p>

<ul>
    {% if company.url %}
    <li>
        公式サイト：
        <a href="{{ company.url }}" target="_blank" rel="noopener">
            {{ company.url }}
        </a>
    </li>
    {% endif %}

    {% if company.description %}
    <li>
        紹介文：<br>
        <small>{{ company.description|linebreaksbr }}</small>
    </li>
    {% endif %}
</ul>

<hr>

<h2>口コミ</h2>

{% if avg_rating %}
  <p>平均評価：★{{ avg_rating|floatformat:1 }} / 5</p>
{% endif %}

{# ★ 並び替えフォーム #}
<form method="get" style="margin-bottom: 8px;">
  <label>
    並び替え:
    <select name="sort" onchange="this.form.submit()">
      <option value="new" {% if sort == "new" %}selected{% endif %}>新着順</option>
      <option value="rating" {% if sort == "rating" %}selected{% endif %}>評価が高い順</option>
    </select>
  </label>
</form>

{% if avg_rating %}
  <p>平均評価：★{{ avg_rating|floatformat:1 }} / 5</p>
{% endif %}

{% if reviews %}
  <ul>
    {% for review in reviews %}
      <li style="margin-bottom:1.2em;">
        <strong>★{{ review.rating }}</strong><br>
        <small>
          {{ review.grade }} /
          {{ review.department_name }} /
          {{ review.lab_field }}<br>
          性別: 
          {% if review.gender == "male" %}男性{% elif review.gender == "female" %}女性
          {% elif review.gender == "other" %}その他{% else %}回答しない{% endif %}
          {% if review.high_school %}
            / 高校: {{ review.high_school }}
          {% endif %}
          / {{ review.created_at|date:"Y-m-d" }}
        </small><br>
        {{ review.comment|linebreaksbr }}
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>まだ口コミは投稿されていません。</p>
{% endif %}

<p>
  <a href="{% url 'shiokara:company_experience_post' company.pk %}">
    この企業の口コミを投稿する
  </a>
</p>

<p>
    <a href="{% url 'shiokara:company_search' %}">← 企業検索に戻る</a>
</p>
{% endblock %}
