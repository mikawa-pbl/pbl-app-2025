{# templates/teams/shiokara/company_experience_post.html #}
{% extends "teams/shiokara/base.html" %}
{% load static %}

{% block content %}
<div class="tut-page-wrapper">
    <!-- 左側サイドバーナビゲーション -->
    {% include "teams/shiokara/includes/sidebar.html" %}

    <!-- メインコンテンツ -->
    <div class="tut-main-content">
<h1>{{ company.name }} の口コミを投稿</h1>

<p>
  このページでは、{{ company.name }} に関する就活・インターン・アルバイトなどの
  体験を、後輩向けの口コミとして共有することを想定しています。
</p>

{% if error %}
  <p style="color:red;">{{ error }}</p>
{% endif %}

<hr>

<form method="post" action="">
    {% csrf_token %}

    <p>
        <label for="id_grade">学年:</label><br>
        <input id="id_grade" type="text" name="grade" style="width: 100%;"
               value="{{ grade }}">
        <small>例: B3, M1 など</small>
    </p>

    <p>
        <label for="id_department_name">学科:</label><br>
        <input id="id_department_name" type="text" name="department_name" style="width: 100%;"
               value="{{ department_name }}">
    </p>

    <p>
        <label for="id_lab_field">分野（研究室）:</label><br>
        <input id="id_lab_field" type="text" name="lab_field" style="width: 100%;"
               value="{{ lab_field }}">
    </p>

    <p>
        <label>性別:</label><br>
        <label>
          <input type="radio" name="gender" value="male"
                 {% if gender == "male" %}checked{% endif %}> 男性
        </label>
        <label>
          <input type="radio" name="gender" value="female"
                 {% if gender == "female" %}checked{% endif %}> 女性
        </label>
        <label>
          <input type="radio" name="gender" value="other"
                 {% if gender == "other" %}checked{% endif %}> その他
        </label>
        <label>
          <input type="radio" name="gender" value="no_answer"
                 {% if gender == "no_answer" or not gender %}checked{% endif %}> 回答しない
        </label>
    </p>

    <!-- 高校名は不要のため削除しました -->

    <p>
        <label for="id_comment">自由記述欄:</label><br>
        <textarea id="id_comment" name="comment" rows="8" style="width: 100%;">{{ comment }}</textarea>
    </p>

    <p>
        <label>評価（★1〜5）:</label><br>
        <input type="hidden" name="rating" id="id_rating" value="{{ rating }}">
        <div id="star_rating" class="stars" role="radiogroup" aria-label="評価">
          <button type="button" class="star" data-value="1" aria-label="1">★</button>
          <button type="button" class="star" data-value="2" aria-label="2">★</button>
          <button type="button" class="star" data-value="3" aria-label="3">★</button>
          <button type="button" class="star" data-value="4" aria-label="4">★</button>
          <button type="button" class="star" data-value="5" aria-label="5">★</button>
        </div>
        <style>
          .stars { display: inline-block; }
          .star { font-size: 28px; color: #ccc; background: none; border: none; padding: 0 4px; cursor: pointer; }
          .star.filled { color: #f5b301; }
          .star:focus { outline: 2px solid #99c; }
        </style>
        <script>
          document.addEventListener('DOMContentLoaded', function () {
            const stars = Array.from(document.querySelectorAll('#star_rating .star'));
            const input = document.getElementById('id_rating');
            let selected = parseInt(input.value) || 0;

            function render(hover) {
              stars.forEach((s, idx) => {
                const v = idx + 1;
                if (hover) {
                  s.classList.toggle('filled', v <= hover);
                } else {
                  s.classList.toggle('filled', v <= selected);
                }
              });
            }

            stars.forEach((s, idx) => {
              const v = idx + 1;
              s.addEventListener('mouseover', () => render(v));
              s.addEventListener('focus', () => render(v));
              s.addEventListener('mouseout', () => render(0));
              s.addEventListener('blur', () => render(0));
              s.addEventListener('click', () => { selected = v; input.value = v; render(0); });
              s.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); selected = v; input.value = v; render(0); }
              });
            });

            // 初期表示
            render(0);
          });
        </script>
    </p>

    <p>
        <button type="submit">口コミを投稿する</button>
    </p>
</form>

<p>
  <a href="{% url 'shiokara:company_detail' company.pk %}">← 企業詳細ページに戻る</a>
</p>
    </div>
</div>
{% endblock %}