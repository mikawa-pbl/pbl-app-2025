{% extends "teams/shiokara/base.html" %}

{% block title %}ãƒã‚¤ãƒšãƒ¼ã‚¸ - å°±æ´»æ”¯æ´ã‚µãƒ¼ãƒ“ã‚¹{% endblock %}

{% block content %}
  <h1>ãƒã‚¤ãƒšãƒ¼ã‚¸</h1>

  {% if person %}
    <p>{{ person.student_id }} ã•ã‚“ã®ç™»éŒ²æƒ…å ±</p>
    <ul>
      <li>å­¦ç±ç•ªå·: {{ person.student_id }}</li>
      <li>èª²ç¨‹: {{ person.course }}</li>
      <li>å­¦å¹´: {{ person.grade }} å¹´</li>
      <li>å­¦ç§‘ãƒ»å°‚æ”»: {{ person.department_name }}</li>
      <li>ç ”ç©¶åˆ†é‡: {{ person.lab_field }}</li>
      <li>ãƒã‚¤ãƒ³ãƒˆ: <strong>{{ person.points }}</strong> pt</li>
      <li>ç™»éŒ²æ—¥æ™‚: {{ person.created_at|date:"Y/m/d H:i" }}</li>
    </ul>
  {% else %}
    <p>ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
  {% endif %}

  <p>â€» å°†æ¥çš„ã«ã“ã“ã«ã€ŒãŠæ°—ã«å…¥ã‚Šä¼æ¥­ã€ã‚„ã€Œã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã€ã‚’è¿½åŠ ã™ã‚‹æƒ³å®šã§ã™ã€‚</p>

<!-- ======================== -->
<!-- ãƒã‚¤ãƒ³ãƒˆæ©Ÿèƒ½ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« -->
<!-- ======================== -->
<style>
    #mypage-tut-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.55);
        z-index: 9998;
        display: none;
    }

    .mypage-tut-highlight {
        position: relative;
        z-index: 9999 !important;
        box-shadow: 0 8px 40px rgba(0,0,0,0.6), 0 0 0 6px rgba(255,255,255,0.05) inset;
        transform: translateZ(0) scale(1.02);
        transition: box-shadow 180ms ease, transform 180ms ease;
        outline: 3px solid rgba(76,175,80,0.95);
        border-radius: 8px;
    }

    #mypage-tut-tooltip {
        position: fixed;
        z-index: 10000;
        max-width: 320px;
        background: #fff;
        color: #222;
        border-radius: 8px;
        box-shadow: 0 6px 28px rgba(0,0,0,0.18);
        padding: 12px;
        display: none;
        font-size: 0.95rem;
    }

    #mypage-tut-tooltip #mypage-tut-controls {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
        margin-top: 8px;
    }

    #mypage-tut-tooltip button {
        background: #f3f3f3;
        border: 1px solid #ddd;
        padding: 6px 10px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
    }

    #mypage-tut-start-btn {
        position: fixed;
        right: 18px;
        bottom: 18px;
        z-index: 10001;
        background: linear-gradient(180deg, #4CAF50, #45a049);
        color: #fff;
        border: none;
        padding: 10px 14px;
        border-radius: 999px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.18);
        cursor: pointer;
        font-weight: 700;
        font-size: 0.9rem;
    }

    @media (max-width:640px) {
        #mypage-tut-tooltip { max-width: 260px; font-size: 0.9rem; }
        #mypage-tut-start-btn { right: 12px; bottom: 12px; font-size: 0.85rem; }
    }
</style>

<div id="mypage-tut-overlay" aria-hidden="true"></div>
<div id="mypage-tut-tooltip" aria-hidden="true" role="dialog" aria-label="ãƒã‚¤ãƒ³ãƒˆæ©Ÿèƒ½èª¬æ˜">
    <div id="mypage-tut-content"></div>
    <div id="mypage-tut-controls">
        <button id="mypage-tut-prev" type="button">æˆ»ã‚‹</button>
        <button id="mypage-tut-next" type="button">æ¬¡ã¸</button>
        <button id="mypage-tut-close" type="button">é–‰ã˜ã‚‹</button>
    </div>
</div>

<button id="mypage-tut-start-btn" aria-label="ãƒã‚¤ãƒ³ãƒˆæ©Ÿèƒ½ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’é–‹å§‹">ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆæƒ…å ±</button>

<script>
    (function(){
        const steps = [
            {
                sel: 'h1',
                title: 'ãƒã‚¤ãƒšãƒ¼ã‚¸ã¸ã‚ˆã†ã“ã',
                body: 'ã“ã“ã¯ã‚ãªãŸã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã¨ã€æœ€ã‚‚é‡è¦ãªã€Œãƒã‚¤ãƒ³ãƒˆã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸ã§ã™ã€‚'
            },
            {
                sel: 'li:has(> strong)',
                title: 'ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º',
                body: 'ã“ã®ã‚µã‚¤ãƒˆã§ã¯ãƒã‚¤ãƒ³ãƒˆåˆ¶åº¦ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ç¾åœ¨ã®ãƒã‚¤ãƒ³ãƒˆæ•°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚'
            },
            {
                sel: 'ul',
                title: 'ãƒã‚¤ãƒ³ãƒˆã®ä½¿ã„æ–¹',
                body: 'ä¼æ¥­è©³ç´°ãƒšãƒ¼ã‚¸ã‚’è¦‹ã‚‹ãŸã³ã«1ãƒã‚¤ãƒ³ãƒˆæ¶ˆè²»ã•ã‚Œã¾ã™ã€‚åŒã˜ä¼æ¥­ã¯2å›ç›®ä»¥é™ã€ãƒã‚¤ãƒ³ãƒˆä¸è¦ã§ã™ã€‚'
            },
            {
                sel: 'p',
                title: 'ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ã—ã‚ˆã†',
                body: 'å£ã‚³ãƒŸã‚’æŠ•ç¨¿ã™ã‚‹ã¨5ãƒã‚¤ãƒ³ãƒˆç²å¾—ã§ãã¾ã™ã€‚ç©æ¥µçš„ã«æŠ•ç¨¿ã—ã¦ã€ãƒã‚¤ãƒ³ãƒˆã‚’å¢—ã‚„ã—ã¾ã—ã‚‡ã†ï¼'
            },
            {
                sel: 'h1',
                title: 'ãƒã‚¤ãƒ³ãƒˆæ©Ÿèƒ½ã®ã¾ã¨ã‚',
                body: 'åˆæœŸå€¤ï¼š10pt | æ¶ˆè²»ï¼šä¼æ¥­è©³ç´°-1pt | ç²å¾—ï¼šå£ã‚³ãƒŸæŠ•ç¨¿+5pt'
            }
        ];

        let idx = 0;
        const overlay = document.getElementById('mypage-tut-overlay');
        const tooltip = document.getElementById('mypage-tut-tooltip');
        const content = document.getElementById('mypage-tut-content');
        const btnPrev = document.getElementById('mypage-tut-prev');
        const btnNext = document.getElementById('mypage-tut-next');
        const btnClose = document.getElementById('mypage-tut-close');
        const startBtn = document.getElementById('mypage-tut-start-btn');

        function showStep(i){
            document.querySelectorAll('.mypage-tut-highlight').forEach(el=>el.classList.remove('mypage-tut-highlight'));
            tooltip.style.display = 'none';
            overlay.style.display = 'block';

            const step = steps[i];
            if(!step) { endTutorial(); return; }
            const target = document.querySelector(step.sel);
            content.innerHTML = '<strong>'+step.title+'</strong><div style="margin-top:6px;">'+step.body+'</div>';

            if(target){
                target.classList.add('mypage-tut-highlight');
                const r = target.getBoundingClientRect();
                const tt = tooltip;
                const margin = 100;
                let top = window.scrollY + r.bottom + margin;
                let left = window.scrollX + r.left;
                left = Math.min(Math.max(left, 8 + window.scrollX), window.scrollX + document.documentElement.clientWidth - tt.offsetWidth - 8);
                tt.style.top = top + 'px';
                tt.style.left = left + 'px';
                tt.style.display = 'block';
                btnNext.focus();
            } else {
                const tt = tooltip;
                tt.style.top = (window.scrollY + window.innerHeight/2 - 80) + 'px';
                tt.style.left = (window.scrollX + (window.innerWidth - tt.offsetWidth)/2) + 'px';
                tt.style.display = 'block';
            }

            btnPrev.disabled = (i===0);
            btnNext.textContent = (i === steps.length -1) ? 'å®Œäº†' : 'æ¬¡ã¸';
            idx = i;
        }

        function nextStep(){
            if(idx < steps.length -1) showStep(idx+1);
            else endTutorial();
        }
        function prevStep(){ if(idx>0) showStep(idx-1); }

        function startTutorial(){
            showStep(0);
            overlay.style.display = 'block';
            document.body.classList.add('mypage-tut-in-progress');
        }

        function endTutorial(){
            overlay.style.display = 'none';
            tooltip.style.display = 'none';
            document.querySelectorAll('.mypage-tut-highlight').forEach(el=>el.classList.remove('mypage-tut-highlight'));
            document.body.classList.remove('mypage-tut-in-progress');
        }

        btnNext.addEventListener('click', nextStep);
        btnPrev.addEventListener('click', prevStep);
        btnClose.addEventListener('click', endTutorial);
        overlay.addEventListener('click', endTutorial);
        startBtn.addEventListener('click', startTutorial);

        document.addEventListener('keydown', (ev)=>{
            if(!document.body.classList.contains('mypage-tut-in-progress')) return;
            if(ev.key === 'Escape') endTutorial();
            if(ev.key === 'ArrowRight' || ev.key === 'Enter') nextStep();
            if(ev.key === 'ArrowLeft') prevStep();
        });

        window.__mypage_tut_start = startTutorial;
    })();
</script>
{% endblock %}
