{# teams/ssk/post_list.html #}
{% load tz %}

<h1>イベント一覧</h1>

<p><a href="{% url 'ssk:post_create' %}">新規投稿</a></p>

{# タグ絞り込み UI を複数選択対応に変更 #}
<form method="get" action="{% url 'ssk:post_list' %}">
  タグで絞る:
  {% for tag in tags %}
    <label style="margin-right:8px;">
      <input type="checkbox" name="tag" value="{{ tag.id }}" {% if tag.id in selected_tag_ids %}checked{% endif %}>
      #{{ tag.name }}
    </label>
  {% endfor %}

  <!-- フィルター方式の選択 -->
  <label style="margin-left:12px;">
    条件:
    <select name="mode">
      <option value="and" {% if selected_mode == "and" %}selected{% endif %}>AND（すべてのタグを含む）</option>
      <option value="or" {% if selected_mode == "or" %}selected{% endif %}>OR（いずれかのタグを含む）</option>
    </select>
  </label>

  <button type="submit">絞り込む</button>
  <a href="{% url 'ssk:post_list' %}">クリア</a>
</form>

{% regroup posts by date|date:"Y年n月" as month_list %}

{% for month in month_list %}
  <h2>{{ month.grouper }}</h2>
  <ul>
    {% for post in month.list %}
      <li>
        <a href="{% url 'ssk:post_detail' post.pk %}">{{ post.title }}</a>
        {% for tag in post.tags.all %}
          <span class="tag">
            #{{ tag.name }}
          </span>
        {% endfor %}
        {{ post.date|date:"n/j" }}
      </li>
    {% endfor %}
  </ul>
{% empty %}
  <p>まだ投稿がありません。</p>
{% endfor %}
