{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="utf-8" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body {
      background-color: #FBFEF9;
      margin: 0;
      padding: 0;
      font-family: "Noto Sans JP", sans-serif;
    }

    .back-btn {
      position: fixed;
      top: 128px;
      left: 32px;
      font-size: 48px;
      color: #649CE4;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      z-index: 9999;
    }
    .back-btn:focus { outline: none; }

    /* 画像 */
    .thumb {
      width: 64px;
      height: 64px;
      border-radius: 16px;
      object-fit: cover;
      cursor: pointer;
      border: 2px solid transparent;
      background: #eee;
      display: block;
    }
    .thumb.is-active { border-color: #649CE4; }

    .main-img {
      width: 400px;
      height: 400px;
      border-radius: 32px;
      object-fit: cover;
      display: block;
      background: #eee;
    }

    /* 右側情報 */
    .info-title { font-size: 32px; font-weight: 700; }
    .info-price { font-size: 24px; margin-top: 24px; }

    .info-text {
      font-size: 16px;
      margin-top: 8px;
      color: #333;
      line-height: 1.7;
      white-space: pre-wrap;
    }

    .tag {
      display: inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background: #EAF2FF;
      color: #2A5DB0;
      margin-right: 8px;
      margin-bottom: 6px;
      font-size: 14px;
      font-weight: 700;
    }

    .badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 999px;
      background: #FFF0F5;
      color: #C2185B;
      font-size: 14px;
      font-weight: 700;
    }

    /* ===== 編集・削除ボタン ===== */
    .action-row {
      display: flex;
      gap: 12px;
      margin-top: 48px;
      width: 640px;
    }

    /* ★重要：aタグも幅を取らせて、クリック領域も含めて完全に同幅にする */
    .action-row a {
      flex: 1;
      display: block;
    }
    .action-row a button {
      width: 100%;
    }

    .edit-btn {
      height: 48px;
      border-radius: 16px;
      background: #EAF2FF;
      color: #2A5DB0;
      font-weight: 700;
      border: 2px solid #649CE4;
      cursor: pointer;
    }

    .delete-btn {
      flex: 1;
      height: 48px;
      border-radius: 16px;
      background: #C62828;
      color: #FFEAEA;
      font-weight: 700;
      border: none;
      cursor: pointer;
    }

    /* ===== 削除確認モーダル ===== */
    .modal-bg {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }

    .modal-box {
      width: 360px;
      background: white;
      border-radius: 24px;
      padding: 24px;
      text-align: center;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 700;
    }

    .modal-text {
      margin-top: 8px;
      color: #555;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    /* ★ここも flex:1 で同幅（見た目もクリック範囲も同じ） */
    .cancel-btn {
      flex: 1;
      height: 40px;
      border-radius: 12px;
      background: #eee;
      border: none;
      font-weight: 700;
      cursor: pointer;
    }

    .danger-btn {
      flex: 1;
      height: 40px;
      border-radius: 12px;
      background: #E53935;
      color: white;
      border: none;
      font-weight: 700;
      cursor: pointer;
    }

    /* aのデフォルト装飾を潰す（念のため） */
    a { text-decoration: none; }
  </style>

  <script>
    function goBack() {
      history.back();
    }

    function changeImage(src, el) {
      const main = document.getElementById("mainImage");
      if (main) main.src = src;

      document.querySelectorAll(".thumb").forEach(t => t.classList.remove("is-active"));
      if (el) el.classList.add("is-active");
    }

    function openDeleteModal() {
      const modal = document.getElementById("deleteModal");
      if (modal) modal.style.display = "flex";
    }

    function closeDeleteModal() {
      const modal = document.getElementById("deleteModal");
      if (modal) modal.style.display = "none";
    }

    window.addEventListener("DOMContentLoaded", () => {
      const first = document.querySelector(".thumb");
      const main = document.getElementById("mainImage");
      if (first && main) {
        first.classList.add("is-active");
        main.src = first.src;
      }

      // 背景クリックで閉じる（箱の外だけ）
      const modal = document.getElementById("deleteModal");
      if (modal) {
        modal.addEventListener("click", (e) => {
          if (e.target === modal) closeDeleteModal();
        });
      }

      // ESCで閉じる
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeDeleteModal();
      });
    });

    function confirmDelete() {
        // ここで本来は削除API/POSTを叩くべき（後でDjangoでやるならそこに差し替え）
        // 今は「削除した体で一覧へ」かつ「戻るで削除画面に戻らない」を最優先で実装する

        const listUrl = "{% url 'takenoko:listing_items' %}";
        window.location.replace(listUrl); // ★履歴を置き換えるので戻るで戻れない
    }

  </script>
</head>

<body>
  {% include "teams/takenoko/Components/header.html" %}

  <button type="button" class="back-btn" onclick="goBack()" aria-label="戻る">
    <i class="fas fa-arrow-alt-circle-left"></i>
  </button>

  <div style="position: relative; width:1184px; margin: 64px auto;">
    <div style="position: relative;">
      <!-- サムネ列 -->
      <div style="position: absolute; display: grid; grid-template-columns: 1fr; row-gap: 20px;">
        <img
          src="{% static 'images/sample.jpg' %}"
          alt="サムネ1"
          class="thumb"
          onclick="changeImage(this.src, this)"
        >
        <img
          src="{% static 'images/sample2.jpg' %}"
          alt="サムネ2"
          class="thumb"
          onclick="changeImage(this.src, this)"
        >
        <img
          src="{% static 'images/noimage.png' %}"
          alt="サムネ3"
          class="thumb"
          onclick="changeImage(this.src, this)"
        >
        <img
          src="{% static 'images/noimage.png' %}"
          alt="サムネ4"
          class="thumb"
          onclick="changeImage(this.src, this)"
        >
        <img
          src="{% static 'images/noimage.png' %}"
          alt="サムネ5"
          class="thumb"
          onclick="changeImage(this.src, this)"
        >
      </div>

      <!-- メイン画像：srcは空（JSで一番上のサムネを入れる） -->
      <div style="position: absolute; margin-left: 80px;">
        <img id="mainImage" class="main-img" src="" alt="メイン画像">
      </div>
    </div>

    <!-- 右側：見た目だけの固定情報 -->
    <div style="position: relative; left: 544px; width: 640px;">
      <p class="info-title">バイク</p>
      <p class="info-price">¥50,000</p>
      <p class="info-text">ほぼ未使用です。保管していただけで走行していません。受け渡しは学内希望。</p>

      <div style="margin-top: 18px;">
        <span class="badge">未使用に近い</span>
      </div>
      <div style="margin-top: 8px;">
        <span class="tag">学部1年</span>
      </div>

      <!-- 編集・削除（同幅） -->
      <div class="action-row">
        <button type="button" class="delete-btn" onclick="openDeleteModal()">削除</button>
        <a href="{% url 'takenoko:item_edit' %}">
          <button type="button" class="edit-btn">編集</button>
        </a>
      </div>
    </div>
  </div>

  <!-- 削除確認（同幅） -->
  <div id="deleteModal" class="modal-bg">
    <div class="modal-box">
      <p class="modal-title">本当に削除しますか？</p>
      <p class="modal-text">この操作は取り消せません。</p>

      <div class="modal-actions">
        <button type="button" class="danger-btn" style="width:100%; flex:1;" onclick="confirmDelete()">
            削除する
        </button>
        <button type="button" class="cancel-btn" onclick="closeDeleteModal()">キャンセル</button>
      </div>
    </div>
  </div>
</body>
</html>
