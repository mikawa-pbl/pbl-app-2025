<h3 class="text-2xl font-bold mb-4">Goods</h3>

<div class="w-screen relative left-1/2 -translate-x-1/2 pb-8 pt-10 md:pt-20">
    <div class="absolute top-0 left-0 w-full h-full bg-[#F5E829]"
        style="clip-path: polygon(0 10rem, 100% 0, 100% 100%, 0 100%);"></div>
    <div class="container mx-auto px-4 relative">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for good in goods %}
            <div>
                <!-- <a href="/team_cake/goods/{{ good.id }}/" class="card-link"> -->
                <!-- <a href="#" class="card-link"> -->
                <a href="#" class="block"
                    onclick="openModal('{{ good.id }}', '{{ good.name|escapejs }}', '{{ good.price }}', '{{ good.description|escapejs }}', '{% if good.original_price is not None %}{{ good.original_price }}{% endif %}')">
                    <div
                        class="bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 overflow-hidden">
                        <div class="relative pb-[75%]">
                            {% if good.image_filename %}
                            <img src="/team_cake/images/{{ good.image_filename }}" alt="{{ good.name }}"
                                class="absolute top-0 left-0 w-full h-full object-cover">
                            {% else %}
                            <img src="/static/images/placeholder-400x300.png" alt="placeholder"
                                class="absolute top-0 left-0 w-full h-full object-cover">
                            {% endif %}
                        </div>
                        <div class="p-4">
                            <span class="block text-xl font-bold mb-2">{{ good.name }}</span>
                            <p class="text-gray-500">{{ good.description|default:"Ë™¨Êòé„Å™„Åó" }}</p>
                        </div>
                        <div class="px-4 pb-4">
                            {% if good.expiration_time %}
                            <div class="text-xs font-bold text-white bg-red-600 px-2 py-1 rounded inline-block mb-2 expiration-timer" data-expire="{{ good.expiration_time.isoformat }}">
                                ÂëΩ„ÅÆÁÅØÁÅ´: Ë®àÁÆó‰∏≠...
                            </div>
                            {% endif %}
                            {% if good.original_price %}
                            <span class="text-gray-500 line-through text-sm mr-2">¬•{{ good.original_price }}</span>
                            {% endif %}
                            <span class="text-[#D71718] font-bold">¬•{{ good.price }}</span>
                            <!-- <a href="/team_cake/goods/{{ good.id }}/" class="right">Ë©≥Á¥∞</a> -->
                            <!-- <a href="#" class="right">Ë©≥Á¥∞</a> -->
                        </div>
                    </div>
                </a>
            </div>
            {% empty %}
            <div class="col-span-full">
                <div class="bg-yellow-50 p-4 rounded border border-yellow-200 text-yellow-800">
                    „Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    function updateTimers() {
        const timers = document.querySelectorAll('.expiration-timer');
        const now = new Date();

        timers.forEach(timer => {
            const expireStr = timer.getAttribute('data-expire');
            if (!expireStr) return;
            
            const expireDate = new Date(expireStr);
            const diff = expireDate - now;

            if (diff <= 0) {
                // Should be deleted on refresh, but handle client-side just in case
                timer.textContent = "ÂªÉÊ£Ñ„Åï„Çå„Åæ„Åó„Åü...";
                timer.classList.replace('bg-red-600', 'bg-gray-600');
            } else {
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                timer.textContent = `üî• ÂëΩ„ÅÆÁÅØÁÅ´: ÊÆã„Çä${hours}ÊôÇÈñì${minutes}ÂàÜ${seconds}Áßí`;
                
                // Urgency effect
                if (hours === 0 && minutes < 30) {
                    timer.classList.add('animate-pulse');
                    timer.style.fontWeight = '900';
                }
            }
        });
    }

    setInterval(updateTimers, 1000);
    updateTimers();
</script>
