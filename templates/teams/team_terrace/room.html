{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{{ room.title }} - Anony Chat</title>
    <link rel="stylesheet" href="{% static 'team_terrace/css/room.css' %}">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’¬</text></svg>">
</head>
<body>
    <!-- Animated Background -->
    <div class="gradient-bg"></div>
    <div class="floating-shapes"></div>

    <!-- Header -->
    <header class="app-header">
        <a href="{% url 'team_terrace:index' %}" class="app-logo">
            <span class="back-icon">â†</span>
            <span>Anony Chat</span>
        </a>
        <span class="room-title">{{ room.title }}</span>
        <div class="sort-controls" aria-label="ä¸¦ã³é †åˆ‡æ›¿">
            <button id="sort-likes-update" class="sort-likes-button" type="button" title="ã„ã„ã­é †ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’æ›´æ–°">æ›´æ–°</button>
            <div class="sort-segment" role="group" aria-label="ä¸¦ã³é †">
                <button id="sort-mode-time" class="sort-segment-btn" type="button">æŠ•ç¨¿é †</button>
                <button id="sort-mode-likes" class="sort-segment-btn" type="button"><span class="heart-red">â™¥</span>æ•°é †</button>
            </div>
        </div>
    </header>

    <!-- Chat Messages -->
    <div id="chat-container">
        <!-- Empty state shown when no messages -->
        <div class="empty-state" id="empty-state">
            <div class="empty-state-icon">ğŸ’­</div>
            <div class="empty-state-text">ã¾ã ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“<br>æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã£ã¦ã¿ã¾ã—ã‚‡ã†</div>
        </div>
    </div>

    <!-- Reaction Animation Canvas -->
    <div id="reaction-canvas"></div>

    <!-- Reaction Bar -->
    <div class="reaction-bar">
        <button class="reaction-btn" onclick="sendReaction('like')" type="button">
            <span class="reaction-icon">ğŸ‘</span>
            <span class="reaction-label">ã„ã„ã­</span>
        </button>
        <button class="reaction-btn" onclick="sendReaction('heh')" type="button">
            <span class="reaction-icon">ğŸ˜®</span>
            <span class="reaction-label">ã¸ã‡ã€œ</span>
        </button>
        <button class="reaction-btn" onclick="sendReaction('question')" type="button">
            <span class="reaction-icon">â“</span>
            <span class="reaction-label">ï¼Ÿï¼Ÿï¼Ÿ</span>
        </button>
        <button class="reaction-btn" onclick="sendReaction('clap')" type="button">
            <span class="reaction-icon">ğŸ‘</span>
            <span class="reaction-label">ã±ã¡ã±ã¡</span>
        </button>
    </div>

    <!-- Input Area -->
    <div id="input-area">
        {% csrf_token %}
        <label class="question-toggle">
            <input type="checkbox" id="is-question">
            <span class="toggle-icon">â“</span>
            <span class="toggle-text">è³ªå•</span>
        </label>
        <textarea id="message-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." autocomplete="off" rows="1"></textarea>
        <div id="send-mode-toggle" class="send-mode-segment" role="group" aria-label="é€ä¿¡ã‚­ãƒ¼">
            <button id="send-mode-enter" class="send-mode-segment-btn" type="button">Enteré€ä¿¡</button>
            <button id="send-mode-ctrlenter" class="send-mode-segment-btn" type="button">Ctrl+Enteré€ä¿¡</button>
        </div>
        <button id="send-button" type="button" aria-label="é€ä¿¡">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 2L11 13"></path>
                <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>
            </svg>
        </button>
    </div>

    <!-- Thread Modal -->
    <div id="thread-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>ã‚¹ãƒ¬ãƒƒãƒ‰</h2>
            <div id="thread-messages"></div>
            <div class="thread-input-area">
                <input type="text" id="reply-input" placeholder="è¿”ä¿¡ã‚’å…¥åŠ›..." autocomplete="off">
                <button onclick="sendReply()" type="button">è¿”ä¿¡</button>
            </div>
        </div>
    </div>

    <script>
        const roomId = "{{ room.uuid }}";
    </script>
    <script src="{% static 'team_terrace/js/room.js' %}"></script>
</body>
</html>
